include:
  - questions.yml
---
attachment:
    filename: wohngeldantrag
    variable name: wohngeldantrag_pdf
    pdf template file: wohngeldantrag.pdf
    fields:

      - "antragsart": ${ antragsart }
      - "antragsteller_wohngeldnummer": |
          % if antragsart != "1":
          ${ antragsteller_wohngeldnummer }
          % endif
      - "antragsteller_familienname": ${ antragssteller[0].name.last }
      - "antragsteller_vorname": ${ antragssteller[0].name.first }
      - "antragsteller_geburtsdatum": |
          ${ format_date(antragssteller[0].geburtsdatum, format='dd.MM.yyyy') }
      - "antragsteller_telefon": ${ antragssteller[0].telefon }
      - "antragsteller_email": ${ antragssteller[0].email }
      - "antragsteller_persoenliche_verhaeltnisse": |
          ${ antragssteller[0].persoenliche_verhaeltnisse }
      - "wohnungsadresse": ${ wohnung_addresse.on_one_line() }
      - "antragsteller_kreditinstitut_name": |
          ${ antragsteller_kreditinstitut_name }
      - "antragsteller_bankleitzahl": ${ antragsteller_bankleitzahl }
      - "antragsteller_kontonummer": ${ antragsteller_kontonummer }
      - "antragsteller_kontoinhaber": ${ antragsteller_kontoinhaber }
      - "zahlungsempfaenger": |
          % if antragsteller_kontoinhaber == "1":
            TO-DO-Antragssteller
          % elif antragsteller_kontoinhaber == "2":
            TO-DO-Familienmitglied  + Adressse
          % else:
            ${ zahlungsempfaenger.address_block()  }
          % endif
      - "person_lebensmittelpunkt_nein": |
          ${ yesno(len(person_nicht_lebensmittelpunkt) == 0, invert=True) }
      - "person_lebensmittelpunkt_ja": |
          ${ yesno(len(person_nicht_lebensmittelpunkt) == 0) }
      - "person_nicht_lebensmittelpunkt": ${ person_nicht_lebensmittelpunkt }
      - "antragsteller_wohnverhaeltnisse": ${ antragsteller_wohnverhaeltnisse }
      - "vermieter": |
          % if antragsteller_wohnverhaeltnisse != "3":
          ${ vermieter }
          % endif   
      - "vermietung_ja": ${ yesno(untervermietung and mitnutzung) }
      - "vermietung_nein": ${ yesno(untervermietung and mitnutzung, invert=True) }
      - "warmmiete": ${ currency(warmmiete) }
      - "datum_einzug": |
          ${ format_date(datum_einzug, format='ddMMyyyy') }
      - "gewerblich_nutzung_ja": ${ yesno(gewerbliche_nutzung) }
      - "gewerblich_nutzung_nein": ${ yesno(gewerbliche_nutzung, invert=True) }
      - "gewerbliche_nutzung_qm": ${ showif('gewerbliche_nutzung_qm', gewerbliche_nutzung) }
      - "vermietung_ja": ${ yesno(untervermietung and mitnutzung) }
      - "vermietung_nein": ${ yesno(untervermietung and mitnutzung, invert=True) }
      - "zuschuesse_ja": ${ yesno(zuschuesse) }
      - "zuschuesse_nein": ${ yesno(zuschuesse, invert=True) } 
      - "zuschuesse_antrag_ja": ${ yesno(zuschuesse) }
      - "zuschuesse_antrag_nein": ${ yesno(zuschuesse, invert=True) }     
    
    
      - "antragssteller_nachname_geburtsname": ${ comma_list(antragssteller[0].name.last, antragssteller[0].geburtsname)}
      - "antragssteller_vorname": ${ antragssteller[0].name.first }
      - "antragssteller_geschlecht": ${ antragssteller[0].geschlecht }
      - "antragssteller_geburtsdatum": ${ antragssteller[0].geburtsdatum }
      - "antragssteller_geburtsort": ${ antragssteller[0].geburtsort }
      - "antragssteller_familienstand": ${ antragssteller[0].familienstand }
      - "antragssteller_beruf": ${ antragssteller[0].beruf }
      - "antragssteller_staatsangehoerigkeit": ${ antragssteller[0].staatsangehoerigkeit }
      - "antragssteller_bruttoeinkuenfte_steuern_ja" : |
          ${ yesno(antragssteller[0].bruttoeinkuenfte_steuern) }
      - "antragssteller_bruttoeinkuenfte_steuern_nein" : |
          ${ yesno(antragssteller[0].bruttoeinkuenfte_steuern, invert=True) }
      - "antragssteller_kpversicherung_ja": |
          ${ yesno(antragssteller[0].kpversicherung) }
      - "antragssteller_kpversicherung_nein": |
          ${ yesno(antragssteller[0].kpversicherung, invert=True) }
      - "antragssteller_rlversicherung_ja": |
          ${ yesno(antragssteller[0].rlversicherung) }
      - "antragssteller_rlversicherung_nein": |
          ${ yesno(antragssteller[0].rlversicherung, invert=True) }             
      - "antragssteller_einkuenfte": |
          % for e in antragssteller[0].einkuenfte:
          - ${ e.name.text }: ${ currency(e.betrag) } (${ e.interval })
          % endfor
      - "antragssteller_einkuenfte_summen": |
          Monatlich: ${ currency(sum([e.betrag for e in antragssteller[0].einkuenfte if e.interval == 'monatlich'])) }
          Jährlich: ${ currency(sum([e.betrag for e in antragssteller[0].einkuenfte if e.interval == 'jährliche Einmalzahlung'])) }         
          
          
          
      - "person_1_nachname_geburtsname": |
          % if len(antragssteller) > 1:
          ${ comma_list(antragssteller[1].name.last, antragssteller[1].geburtsname)}
          % endif
      - "person_1_vorname": |
          % if len(antragssteller) > 1:
          ${ antragssteller[1].name.first }
          % endif
      - "person_1_geschlecht": |
          % if len(antragssteller) > 1:
          ${ antragssteller[1].geschlecht }
          % endif
      - "person_1_geburtsdatum": |
          % if len(antragssteller) > 1:
          ${ antragssteller[1].geburtsdatum }
          % endif
      - "person_1_geburtsort": |
          % if len(antragssteller) > 1:
          ${ antragssteller[1].geburtsort }
          % endif
      - "person_1_familienstand": |
          % if len(antragssteller) > 1:
          ${ antragssteller[1].familienstand }
          % endif
      - "person_1_verwandschaftsverhaeltnis": |
          % if len(antragssteller) > 1:
          ${ antragssteller[1].verwandschaftsverhaeltnis }
          % endif
      - "person_1_beruf": |
          % if len(antragssteller) > 1:
          ${ antragssteller[1].beruf }
          % endif
      - "person_1_staatsangehoerigkeit": |
          % if len(antragssteller) > 1:
          ${ antragssteller[1].staatsangehoerigkeit }
          % endif

      - "person_1_bruttoeinkuenfte_steuern_ja": |
          % if len(antragssteller) > 1:
          ${ yesno(antragssteller[1].bruttoeinkuenfte_steuern) }
          % endif
      - "person_1_bruttoeinkuenfte_steuern_nein": |
          % if len(antragssteller) > 1:
          ${ yesno(antragssteller[1].bruttoeinkuenfte_steuern, invert=True) }
          % endif
      - "persion_1_kpversicherung_ja": |
          % if len(antragssteller) > 1:
          ${ yesno(antragssteller[1].kpversicherung) }
          % endif
      - "persion_1_kpversicherung_nein": |
          % if len(antragssteller) > 1:
          ${ yesno(antragssteller[1].kpversicherung, invert=True) }
          % endif
      - "person_1_rlversicherung_ja": |
          % if len(antragssteller) > 1:
          ${ yesno(antragssteller[1].rlversicherung) }
          % endif
      - "person_1_rlversicherung_nein": |
          % if len(antragssteller) > 1:
          ${ yesno(antragssteller[1].rlversicherung, invert=True) }
          % endif
      - "person_1_einkuenfte": |
          % if len(antragssteller) > 1 and len(antragssteller[1].einkuenfte) >= 1:
          % for e in antragssteller[1].einkuenfte:
          - ${ e.name.text }: ${ currency(e.betrag) } (${ e.interval })
          % endfor
          % endif
      - "person_1_einkuenfte_summen": |
          % if len(antragssteller) > 1 and len(antragssteller[1].einkuenfte) >= 1:
          Monatlich: ${ currency(sum([e.betrag for e in antragssteller[1].einkuenfte if e.interval == 'monatlich'])) }
          Jährlich: ${ currency(sum([e.betrag for e in antragssteller[1].einkuenfte if e.interval == 'jährliche Einmalzahlung'])) }
          % endif


      - "person_2_nachname_geburtsname": |
          % if len(antragssteller) > 2:
          ${ comma_list(antragssteller[2].name.last, antragssteller[2].geburtsname)}
          % endif
      - "person_2_vorname": |
          % if len(antragssteller) > 2:
          ${ antragssteller[2].name.first }
          % endif          
      - "person_2_geschlecht": |
          % if len(antragssteller) > 2:
          ${ antragssteller[2].geschlecht }
          % endif
      - "person_2_geburtsdatum": |
          % if len(antragssteller) > 2:
          ${ antragssteller[2].geburtsdatum }
          % endif
      - "person_2_geburtsort": |
          % if len(antragssteller) > 2:
          ${ antragssteller[2].geburtsort }
          % endif
      - "person_2_familienstand": |
          % if len(antragssteller) > 2:
          ${ antragssteller[2].familienstand }
          % endif
      - "person_2_verwandschaftsverhaeltnis": |
          % if len(antragssteller) > 2:
          ${ antragssteller[2].verwandschaftsverhaeltnis }
          % endif
      - "person_2_beruf": |
          % if len(antragssteller) > 2:
          ${ antragssteller[2].beruf }
          % endif
      - "person_2_staatsangehoerigkeit": |
          % if len(antragssteller) > 2:
          ${ antragssteller[2].staatsangehoerigkeit }
          % endif          
          
      - "person_2_bruttoeinkuenfte_steuern_ja": |
          % if len(antragssteller) > 2:
          ${ yesno(antragssteller[2].bruttoeinkuenfte_steuern) }
          % endif
      - "person_2_bruttoeinkuenfte_steuern_nein": |
          % if len(antragssteller) > 2:
          ${ yesno(antragssteller[2].bruttoeinkuenfte_steuern, invert=True) }
          % endif
      - "persion_2_kpversicherung_ja": |
          % if len(antragssteller) > 2:
          ${ yesno(antragssteller[2].kpversicherung) }
          % endif
      - "persion_2_kpversicherung_nein": |
          % if len(antragssteller) > 2:
          ${ yesno(antragssteller[2].kpversicherung, invert=True) }
          % endif
      - "person_2_rlversicherung_ja": |
          % if len(antragssteller) > 2:
          ${ yesno(antragssteller[2].rlversicherung) }
          % endif
      - "person_2_rlversicherung_nein": |
          % if len(antragssteller) > 2:
          ${ yesno(antragssteller[2].rlversicherung, invert=True) }
          % endif       
      - "person_2_einkuenfte": |
          % if len(antragssteller) > 2 and len(antragssteller[2].einkuenfte) >= 1:
          % for e in antragssteller[2].einkuenfte:
          - ${ e.name.text }: ${ currency(e.betrag) } (${ e.interval })
          % endfor
          % endif
      - "person_2_einkuenfte_summen": |
          % if len(antragssteller) > 2 and len(antragssteller[2].einkuenfte) >= 1:
          Monatlich: ${ currency(sum([e.betrag for e in antragssteller[2].einkuenfte if e.interval == 'monatlich'])) }
          Jährlich: ${ currency(sum([e.betrag for e in antragssteller[2].einkuenfte if e.interval == 'jährliche Einmalzahlung'])) }
          % endif          
       
---
code: |
  output_file = pdf_concatenate(wohngeldantrag_pdf, unterhaltsverpflichtungen, wohnung_angaben_anlage, untervermietung_und_mitnutzung_anlage, zuschuesse_anlage, filename="Wohngeldantrag_final.pdf")
---
# TO-DO: Hinweis und wo hinschicken
# To-DO: Manche Variablen wurden nicht am Ende definiert?
section: zusammenfassung
question: Hier ist Ihr ausgefüllter Wohngeldantrag!
attachment code: wohngeldantrag_pdf

subquestion: |
  ${ static_image('undraw_Done_re_oak4.svg', width='60%') }
  
  **Hinweis zur fehlerhaften Webansicht mit Google Chrome**:
  
  Wenn Sie den ausgefüllten Wohngeldantrag in der PDF Google Chrome Ansicht zum Dowload öffnen, scheint es als wenn nicht alle Boxen korrekt angekreutzt sind:
  
  ${ static_image('google_chrome_fehlerhafte_ansicht.png', width='100%') }
  
  Nach dem Download, sieht man jedoch das die Boxen in der Tat korrekt angekreutzt wurden:
  
  ${ static_image('pdf_korrekte_ansicht.png', width='100%') }
  <br>
  <br>
  ## Ihre finalen Schritte zum Antrag:
  
  1. Den Wohngeldantrag herunterladen, ausdrucken und auf der letzten Seite unterschreiben.
  2. Ggf. weitere Anhänge herunterladen, ausdrucken und unterschreiben.
  3. Unterlagen mit den passenden Porto und Briefumschlag versandfertig machen und an dein örtliches Wohngeldamt senden: 
  ${ static_image('versandoptionen.png', width='100%') }
event: final_document